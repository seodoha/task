<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select</title>
    <style>
        * {margin: 0;padding: 0;box-sizing: border-box;}
        li {list-style: none;}
        body {height: 100vh;background-color: seagreen;}
        button {text-align: left;}
        section {position: absolute;left: 50%;top: 10px;transform: translateX(-50%);}
        .hide-select {position: absolute;overflow: hidden;width: 0;height: 0;border: 0;}
        .customSelectWrap {position: relative;width: 200px;}
        .customSelectWrap button {display: block;position: relative;padding: 0 38px 0 10px;width: 100%;line-height: 38px;border: 1px solid #ddd;background-color: #f8f8f8;overflow: hidden;text-overflow: ellipsis;user-select: none;font-weight: 400;font-size: 12px;cursor: pointer;white-space: nowrap;}
        .customSelectWrap button::after {content: " ";position: absolute;right: 10px;top: 50%;transform: translateY(-50%);width: 0;height: 0;border: 4px solid transparent;border-top-color: #BBB;border-bottom: none;}
        .customSelectWrap.on button::after {border-top: none;border-bottom: 4px solid #bbb;}
        .customSelectWrap .select-item {display: none;position: absolute;width: 100%;z-index: 1;overflow: hidden;}
        .customSelectWrap .select-item ul {position: absolute;width: 100%;border-width: 0 1px 1px 1px;border-style: solid;border-color: #ddd;}
        /* .customSelectWrap .select-item ul::-webkit-scrollbar {display: none;} */
        .customSelectWrap .select-item li {padding: 10px;font-size: 12px;line-height: 20px;background-color: #f8f8f8;cursor: pointer;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}
        .customSelectWrap .select-item li.select,
        .customSelectWrap .select-item li:hover {background-color: #D0D0D0;}
        .customSelectWrap .select-item li ~ li {border-top: 1px solid #ddd;}
        .scrollBar {position: absolute;right: 0;top: 0;width: 10px;height: 100%;background-color: violet;}
        .scrollBar .track {position: absolute;left: 50%;top: 0;margin: 5px 0 10px -3px;width: 6px;height: 40px;border-radius: 10px;background-color: aqua;}
    </style>
    <script src="../jquery-1.12.0.min.js"></script>
</head>
<body>
    <section>
        <select data-module="customSelect" data-scroll="5">
            <option value="realmadrid" selected>레알마드리드</option>
            <option value="barcelona">바르셀로나</option>
            <option value="valencia">발렌시아</option>
            <option value="atmadrid">아틀레티코마드리드</option>
            <option value="sevilla">세비야</option>
            <option value="sociedad">레알소시에다드</option>
            <option value="betis">베티스</option>
            <option value="alaves">알라베스</option>
            <option value="sporting">스포르팅히혼</option>
            <option value="granada">그라나다</option>
            <option value="deportivo">데포르티보</option>
            <option value="rayo">라요</option>
            <option value="leganes">레가네스</option>
            <option value="espanyol">에스파뇰</option>
        </select>
        <br><br>
        <select data-module="customSelect" data-scroll="2">
            <option value="interMilan">인터밀란</option>
            <option value="juventus">유벤투스</option>
            <option value="milan">AC밀란</option>
            <option value="asRoma" selected>AS로마</option>
        </select>
    </section>
    <script>
        $('[data-module="customSelect"]').length && customSelect();
        let wheelCount = 0;

        function customSelect() {
            let $el = $('[data-module="customSelect"]');

            $el.each(function(index, elItem) {
                let itemW = $(elItem).width(),
                    $customSelect = '<div class="customSelectWrap">',
                    $lab = '<button class="label">',
                    $opt = '<div class="select-item"><ul>';

                if ( $(elItem).find('option').length > 0 ) {
                    $(elItem).find('option').each(function(index, item) {
                        let itemTxt = $(item).text();

                        if ( $(item).prop('selected') ) {
                            $lab += (itemTxt + '</button>');
                            $opt += '<li data-index="' + index + '" class="select">' + itemTxt + '</li>';
                        } else {
                            $opt += '<li data-index="' + index + '">' + itemTxt + '</li>';
                        }

                    });
                    $opt += '</ul></div>';
                }
                
                $customSelect = $customSelect + $lab + $opt + '</div>';
                $(elItem).addClass('hide-select').after($customSelect);
            })
        };

        function selectScroll() {
            $('.select-item').on('scroll mousewheel', function(e){
                let wheel = e.originalEvent.wheelDelta,
                    viewCount = $(this).parent().prev().attr('data-scroll'),
                    maxCount = Number('-' + ($('li', this).length - viewCount)),
                    $track = $('.scrollBar .track',this);

                if ( wheel > 0 ) {
                    if ( wheelCount < 0 ) wheelCount++;
                } else {
                    if ( wheelCount > maxCount ) wheelCount--;
                }
                
                $('ul', this).css({'top': wheelCount * 41});
                $track.css({'top':-(wheelCount * 41)});
                console.log(`스크롤 wheelCount : ${wheelCount}`);
            });
        };

        $('.customSelectWrap button').on('click', function(){
            let itemH = '41',
                $custom = $(this).parent(),
                $list = $(this).siblings('.select-item').find('ul'),
                $track = $list.siblings('.scrollBar').find('.track'),
                listLength = $(this).siblings('.select-item').find('ul > li').length,
                scrollCount = $custom.prev().attr('data-scroll'),
                selectIndex = $list.find('li.select').index(),
                listHeight = itemH * scrollCount;

            $('.select-item').stop().slideUp('fast');
            $list.parent().css({'height' : listHeight});
            
            $(this).parent().toggleClass('on');
            $(this).siblings('.select-item').stop().slideToggle('fast');
            
            wheelCount = selectIndex - (scrollCount - 1) > 0 ? '-' + (selectIndex - (scrollCount - 1)) : 0;
            $list.css({'top': wheelCount * 41});
            
            if ( scrollCount < listLength && $custom.find('.scrollBar').length <= 0 ) {
                $list.after('<span class="scrollBar"><span class="track" style="top:' + ((selectIndex+1) / listLength) * 100 + '%"></span></span>');
            } else {
                $track.css({'top':((selectIndex+1) / listLength) * 100 + '%'});
            }

            console.log(`버튼 클릭 후 wheelCount : ${wheelCount}`);

        });

        $('.select-item li').on('click', function(){
            let $parent = $(this).closest('.select-item'),
                $txt = $(this).text(),
                $select = $(this).closest('.customSelectWrap').prev(),
                scrollCount = $(this).closest('.customSelectWrap').prev().attr('data-scroll'),
                index = $(this).index();

            $parent.find('li').removeClass('select');
            $(this).addClass('select');
            $parent.stop().slideUp('fast').siblings('.label').text($txt);
            $('.customSelectWrap').removeClass('on');
            $select.find('option').eq(index).prop('selected', true);
            
            wheelCount = '-' + (index - (scrollCount - 1));
            $(this).parent().css({'top': wheelCount * 40 });
        });

        $('body').on('click', function(e){
            let $target = $(e.target).parent();
            if ( !$target.hasClass('customSelectWrap') ) {
                $('.customSelectWrap').removeClass('on');
                $('.select-item').stop().slideUp('fast');
            }
        });
        
        selectScroll();
    </script>
    </script>
</body>
</html>
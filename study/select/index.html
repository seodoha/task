<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select</title>
    <link rel="stylesheet" href="jquery.mCustomScrollbar.min.css">
    <style>
        * {margin: 0;padding: 0;box-sizing: border-box;}
        li {list-style: none;}
        body {height: 100vh;background-color: wheat;}
        button {text-align: left;}
        section {position: absolute;left: 50%;top: 10px;transform: translateX(-50%);}
        .hide-select {position: absolute;overflow: hidden;width: 0;height: 0;border: 0;}
        .customSelectWrap {position: relative;width: 200px;}
        .customSelectWrap button {display: block;position: relative;padding: 0 38px 0 10px;width: 100%;line-height: 38px;border: 1px solid #ddd;background-color: #f8f8f8;overflow: hidden;text-overflow: ellipsis;user-select: none;font-weight: 400;font-size: 12px;cursor: pointer;white-space: nowrap;}
        .customSelectWrap button::after {content: " ";position: absolute;right: 10px;top: 50%;transform: translateY(-50%);width: 0;height: 0;border: 4px solid transparent;border-top-color: #BBB;border-bottom: none;}
        .customSelectWrap.on button::after {border-top: none;border-bottom: 4px solid #bbb;}
        .customSelectWrap .select-item {display: none;position: absolute;width: 100%;border: 1px solid #ddd;z-index: 1;overflow: auto;}
        .customSelectWrap .select-item li {padding: 10px;font-size: 12px;line-height: 20px;background-color: #f8f8f8;cursor: pointer;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}
        .customSelectWrap .select-item li.select,
        .customSelectWrap .select-item li:hover {background-color: #D0D0D0;}
        .customSelectWrap .select-item li ~ li {border-top: 1px solid #ddd;}
        .mCSB_container {width: 100%;}
    </style>
    <script src="../jquery-1.12.0.min.js"></script>
    <script src="jquery.mCustomScrollbar.concat.min.js"></script>
</head>
<body>
    <section>
        <select data-module="customSelect" data-scroll="3">
            <option value="realmadrid">레알마드리드</option>
            <option value="barcelona">바르셀로나</option>
            <option value="valencia" selected>발렌시아</option>
            <option value="atmadrid">아틀레티코마드리드</option>
            <option value="sevilla">세비야</option>
        </select>
        <br><br>
        <select data-module="customSelect" data-scroll="4">
            <option value="">인터밀란</option>
            <option value="">유벤투스</option>
            <option value="">AC밀란</option>
            <option value="">로마</option>
        </select>
    </section>
    <script>
        $('[data-module="customSelect"]').length && customSelect();
        
        function customSelect() {
            let $el = $('[data-module="customSelect"]');

            $el.each(function(index, elItem) {
                let itemW = $(elItem).width(),
                    $customSelect = '<div class="customSelectWrap">',
                    $lab = '<button class="label">',
                    $opt = '<ul class="select-item">';

                if ( $(elItem).find('option').length > 0 ) {
                    $(elItem).find('option').each(function(index, item) {
                        let itemTxt = $(item).text();

                        if ( $(item).prop('selected') ) {
                            $lab += (itemTxt + '</button>');
                            $opt += '<li data-index="' + index + '" class="select">' + itemTxt + '</li>';
                        } else {
                            $opt += '<li data-index="' + index + '">' + itemTxt + '</li>';
                        }

                    });
                    $opt += '</ul>';
                }
                
                $customSelect = $customSelect + $lab + $opt + '</div>';
                $(elItem).addClass('hide-select').after($customSelect);
            })
        }

        $('.customSelectWrap button').on('click', function(){
            let $itemH = '40',
                $custom = $(this).parent(),
                $list = $(this).siblings('.select-item'),
                $scrollCount = $custom.prev().attr('data-scroll');

            $('.select-item').stop().slideUp('fast');
            $list.css({'height' : $itemH * $scrollCount}).mCustomScrollbar();


            $(this).parent().toggleClass('on');
            $(this).siblings('ul').stop().slideToggle('fast');
        });

        $('.select-item li').on('click', function(){
            let $parent = $(this).parent(),
                $txt = $(this).text(),
                $select = $(this).closest('.customSelectWrap').prev(),
                index = $(this).index();

            $parent.find('li').removeClass('select');
            $(this).addClass('select');
            $parent.stop().slideUp('fast').siblings('.label').text($txt);
            $('.customSelectWrap').removeClass('on');
            $select.find('option').eq(index).prop('selected', true);
        });

        $('body').on('click', function(e){
            let $target = $(e.target).parent();
            if ( !$target.hasClass('customSelectWrap') ) {
                $('.customSelectWrap').removeClass('on');
                $('.select-item').stop().slideUp('fast');
            }
        });
    </script>
    </script>
</body>
</html>